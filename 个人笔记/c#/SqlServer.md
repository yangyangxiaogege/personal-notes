# Sql Server

## 1.1 数据库简介

### 1.1.1 为什么要使用数据库

- 能够结构化存储大量信息
- 可以快速查询和检索数据
- 可以保证数据的安全性

### 1.1.2 市面常见的数据库

- DB2 (IBM公司产品)	--------------适合存储海量数据，常用于电信，银行等领域
- Oracle (甲骨文公司产品)        -------------数据库中的老大哥，功能最强大，历史悠久
- MySql (甲骨文公司产品)        -------------小巧，轻便，免费，开源，适合于中小型企业
- SQL Server (微软公司产品)         --------------简单易用	

##1.2 系统数据库

- Master 记录所有系统级别信息
- Tempdb 临时存储
- Model 数据库的模板信息
- Msdb 任务调度，数据库备份，还原数据库
- Resource 包含了数据库中的系统对象，只读数据库

##1.3 数据库的超级管理员

sa (super administrator)

## 1.4 数据库文件

- 主数据库文件 *.mdf
- 次要数据库文件 *.ndf
- 日志文件 *.ldf

## 1.5 分离和附加

通过数据库的分离和附加可以进行数据库的迁移

## 1.6 数据库的备份和还原

对数据库的备份是为了防止数据库被误删，数据丢失，生成的备份文件以.bak结尾

## 1.7 列的数据类型

- 文本
  - char 固定长度的非unicode字符，不够的用空格填充
  - varchar 可变长度的非Unicode字符，一个英文占一个字节，一个中文占两个字节
  - nchar 固定长度的Unicode字符
  - nvarchar 非固定长度的Unicode字符每个字符统一占两个字节
  - text 长文本信息，例如一篇博文
- 日期
  - datetime 日期时间类型
- 数值
  - int 
  - smallint
  - tinyint
  - bigint
  - float
  - real
- 货币
  - money 保留小数点后4位数
- 布尔类型
  - bit 值只能为0/1

## 1.8 基本sql语句

- insert 插入

  ```sql
  -- 插入整列
  insert into 表名 values(列值，需要按顺序输入)
  -- 插入部分列
  insert into 表名 （列名） values(列值)
  
  -- 一次插入多条数据 方式1：从现有表(a)中查出数据迁移到该表(b)，前提，表(b)已经存在
  insert into 表名(b) （列名）select (列名) from 表名(a)
  -- 一次插入多条数据 方式2：从现有表(a)中查出数据迁移到新表(b),表（b）不能存在
  select * into 表(b) from 表(a) 表结构+数据
  select * into 表(b) from 表(a) where 1=2 表结构
  -- 一次插入多条数据 方式3：
  insert into 表名 (列名)
  select 字段值 union
  select 字段值 union
  ... 
  -- 注意 最后一句省略关键字 union
  
  
  ```

  > 如果有自动增长列，插入值时可以省略，如果有默认值，使用关键子default代替

- update 修改

  ```sql
  update 表名 set 列明=字段值 where [更新条件] -- 不写条件表示更新所有 
  
  ```

- delete 删除

  ```sql
  delete from 表名 where [删除条件]
  
  truncate 表名
  相当于没有条件的delete,效率比delete高
  删除后资源无法恢复
  一般很少用
  ```

- select 查询

  ```sql
  -- 查询某张表中的所有数据
  select * from 表名
  -- 根据一定的条件对某张表的数据进行查询
  select * from where [查询条件]
  -- 连接查询，进行多表联查
  select * from 表1
  inner join 表2
  on 表1.主键 = 表2.与表1进行关联的外键
  
  ```

### 1.8.1 聚合函数

- 聚合函数的主要作用是用于统计查询
- 聚合函数只返回一个值
- sum() 总和
- avg() 平均值
- max()/min() 最大最小值
- count 统计个数

### 1.8.2 查询语句中关键字顺序

```sql
select xxx from table
where //用于进行直接筛选
group by // 对某列进行分组
having // 用于筛选分组后的数据
order by
```



## 1.9  数据完整性

- 实体完整性

  - 不能存在完全相同的一行数据，每一个实体对象都是不一样的

  - 主键 primary key
    - 每张表都要有一个主键
    - 主键由一列或者几列组成，多列组成的主键称为复合主键
    - 主键是必填项，且不可重复
    - 主键通常是一些无太大意义的编号
    - 主键保证了一个表中不会出现完全相同的数据

- 域完整性

  - 域就是列，域完整性就是指每一列或者说每个单元格数据要规范
  - 非空约束
  - 默认值
  - 标识列
    - 自动增长
    - 整型数据类型可用
  - 唯一约束，通过唯一索引实现
  - 检查约束，编写检查表达式
    - sex='男' or sex = '女'
    - age>0 and age<=18
    - email like '%@%'
    - phone like '186%'
    - ...

- 外键完整性约束

  - 插入数据时需要先插入从表，在插入主表

